#!/usr/bin/env node

// 首先调用，这句话就起作用了
console.info('hexo cmd');

// 初始化了一堆变量
var args = require('minimist')(process.argv.slice(2)),
  fs = require('graceful-fs'),
  path = require('path'),
  async = require('async'),
  // 首先调用的是lib/init文件
  init = require('../lib/init'),
  cwd = process.cwd(),
  lastCwd = cwd;


// Find Hexo folder recursively
// async包都有哪些用处呢?
async.doUntil(
  function(next){
    var configFile = path.join(cwd, '_config.yml');

    fs.exists(configFile, function(exist){
      if (exist){
        init(cwd, args);
      } else {
        lastCwd = cwd;
        cwd = path.dirname(cwd);
        next();
      }
    });
  },
  function(){
    return cwd === lastCwd;
  },
  function(){
    init(process.cwd(), args);
  }
);